<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
    </style>

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
            <!-- Make sure you put this AFTER Leaflet's CSS -->
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
</head>

<body>
    <div id="map" />


    <script >
        let V;
        let map;
        
            // @ts-ignore
            V = L;
            map = V.map("map").setView([51.505, -0.09], 13);
            // V.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            //     maxZoom: 18,
            //     attribution:
            //         'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
            //         '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            //         'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            //     id: "mapbox.streets",
            // }).addTo(map);
            // let tile = "https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{x}/{y}"
            let tile = "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}"
            V.tileLayer(tile, {
                accessToken: "pk.eyJ1Ijoic3luY3luYXR5IiwiYSI6ImNscDZ2ZW00cTF4aHQycnFvbDZsdGpmejEifQ.DbipEmVV5FTXccLV1x6gjg",
                foo: "bar",
                id: "mapbox/satellite-v9",
                attribution:
                    '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            }).addTo(map);

            // V.tileLayer("https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}", {
            //     maxZoom: 20,
            //     subdomains: ["mt0", "mt1", "mt2", "mt3"],
            // }).addTo(map);

            // show user location by gps
            map.locate({ setView: true, maxZoom: 16 });

            var polygonPoints = [];
            var polygon;
            polygon = V.polygon(polygonPoints, { color: "red" }).addTo(map);
            map.on("click", function (e) {
                if (window["drawing"] === false) return;
                // Retrieve the coordinates of the clicked point
                var lat = e.latlng.lat;
                var lng = e.latlng.lng;

                polygonPoints.push([lat, lng]);
                // Store the retrieved coordinates in an array
                polygon.setLatLngs(polygonPoints);
                polygon.addTo(map);
                window["polygons"] = polygonPoints;
                // Use the array of coordinates to draw a polygon on the map instance
            });
            window["clearPolygon"] = () => {
                polygonPoints = [];
                polygon.setLatLngs(polygonPoints);
                window["polygons"] = polygonPoints;
            };

            window["undoPolygon"] = () => {
                polygonPoints.pop();
                polygon.setLatLngs(polygonPoints);
                window["polygons"] = polygonPoints;
            };

            //window["res"] = "nice";
    
    </script>
</body>
</html>